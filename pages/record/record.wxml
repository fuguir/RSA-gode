<!-- pages/record/record.wxml -->
<view class="page-container">
  <!-- 顶部状态区 -->
  <view class="status-section">
    <view class="status-item">
      <view class="status-icon {{gpsStatus ? 'active' : ''}}">
        <!-- GPS图标 -->
        <view class="icon-gps"></view>
      </view>
      <view class="status-info">
        <text class="status-label">GPS</text>
        <text class="status-value">{{gpsStatus ? '已连接' : '未连接'}}</text>
        <text class="status-detail" wx:if="{{accuracy}}">±{{accuracy}}m</text>
      </view>
    </view>

    <view class="status-item">
      <view class="status-icon {{connected ? 'active' : ''}}">
        <!-- 蓝牙图标 -->
        <view class="icon-bluetooth"></view>
      </view>
      <view class="status-info">
        <text class="status-label">相机</text>
        <text class="status-value">{{statusText}}</text>
      </view>
    </view>

    <view class="status-item">
      <view class="status-icon">
        <!-- 卫星图标 -->
        <view class="icon-satellite"></view>
      </view>
      <view class="status-info">
        <text class="status-label">卫星数</text>
        <text class="status-value">{{satellites || 0}}</text>
      </view>
    </view>
  </view>

  <!-- 中部地图区 -->
  <view class="map-section">
    <map 
      wx:if="{{locationReady}}"
      id="trackMap"
      class="track-map"
      latitude="{{mapCenter.latitude}}"
      longitude="{{mapCenter.longitude}}"
      scale="{{mapScale}}"
      show-location
      show-compass
      enable-rotate
      enable-zoom
      polyline="{{trackPolylines}}"
      markers="{{mapMarkers}}">
      
      <!-- 速度显示面板 -->
      <cover-view class="speed-panel">
        <cover-view class="speed-value">{{showSpeed}}</cover-view>
        <cover-view class="speed-unit">km/h</cover-view>
      </cover-view>
    </map>
    <view class="map-loading" wx:else>
      <text>GPS定位中...</text>
    </view>
  </view>

  <!-- 底部控制区 -->
  <view class="control-section">
    <view class="stake-display">
      <text class="stake-value">{{showStake}}</text>
      <view class="direction-indicator {{!isIncreasing ? 'down' : ''}}">
        {{isIncreasing ? '↑' : '↓'}}
      </view>
    </view>

    <view class="control-buttons">
      <!-- 连接按钮 -->
      <view class="connect-button {{connected ? 'connected' : ''}}" 
            bindtap="onConnect" 
            wx:if="{{!connected}}">
        <view class="icon-bluetooth"></view>
        <text>连接相机</text>
      </view>
      
      <!-- 录制按钮仅在连接后显示 -->
      <view class="record-button {{isRecording ? 'recording' : ''}}" 
            bindtap="onRecordToggle"
            wx:if="{{connected}}">
        <view class="record-icon"></view>
      </view>
    </view>

    <view class="function-buttons">
      <!-- 校准按钮 -->
      <view class="function-btn" bindtap="onCalibrateStake">
        <view class="icon-calibrate"></view>
        <text>校准</text>
      </view>
    </view>
  </view>
</view>